{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel Operação Santos</title>
  <link rel="icon" type="image/png" href="{% static 'imagens/icone.png' %}">

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: 'Inter', sans-serif;
    }
    main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
      width: 100%;
    }
    h1, h2 {
      line-height: 1.2;
    }
    h1 {
      font-size: clamp(3rem, 6vw, 7rem);
    }
    h2 {
      font-size: clamp(1.5rem, 2.5vw, 3rem);
    }
    table {
      font-size: clamp(1rem, 1.5vw, 1.8rem);
    }
  </style>
</head>
<body class="{% if tema == 'escuro' %}bg-gray-900 text-gray-100{% elif tema == 'azul' %}bg-blue-50 text-blue-900{% else %}bg-gray-100 text-gray-800{% endif %} px-8 py-8">

  <!-- HEADER -->
  <header class="mb-12 flex justify-between items-center border-b pb-6 {% if tema == 'escuro' %}border-gray-700{% else %}border-gray-300{% endif %}">
    <div class="flex items-center gap-4">
      <a href="{% url 'lancamento_list' %}" class="p-3 rounded-full border {% if tema == 'escuro' %}border-gray-600 hover:bg-gray-700{% else %}border-gray-300 hover:bg-gray-200{% endif %} transition">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="h-12 w-12">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
      </a>
      <div>
        <h1 class="text-[clamp(1rem,1.5vw,1.6rem)] font-bold leading-tight {% if tema == 'escuro' %}text-white{% else %}text-gray-800{% endif %}">
          Transcamila - Porto de Santos
        </h1>
        <p class="text-[clamp(1.5rem,2.5vw,3rem)] {% if tema == 'escuro' %}text-gray-400{% else %}text-gray-500{% endif %}">
          Painel de controle operacional
        </p>
      </div>
    </div>
    {% if tema == 'escuro' %}
  <img src="{% static 'imagens/Transcamila-branca.png' %}" alt="Logo Transcamila" class="h-20 object-contain">
{% else %}
  <img src="{% static 'imagens/Transcamila.png' %}" alt="Logo Transcamila" class="h-20 object-contain">
{% endif %}

  </header>

  <!-- CARDS -->
  <main>
    {% for destino in data %}
    <div class="{% if tema == 'escuro' %}bg-gray-800{% elif tema == 'azul' %}bg-white{% else %}bg-white{% endif %} rounded-xl p-6 shadow-md hover:shadow-lg transition">
      <h2 class="font-semibold text-[clamp(1rem,1.5vw,1.6rem)] mb-5">Santos x {{ destino.destino_nome }}</h2>
      <table class="w-full">
        <thead>
          <tr class="text-left text-[clamp(1rem,1.5vw,1.6rem)] border-b {% if tema == 'escuro' %}border-gray-600 text-gray-400{% else %}text-gray-500{% endif %} uppercase text-sm">
            <th class="py-3">PO</th><th>Destino</th><th>Qtd</th><th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% if destino.lancamentos %}
            {% for l in destino.lancamentos %}
            <tr class="border-b {% if tema == 'escuro' %}border-gray-600 hover:bg-gray-700{% else %}hover:bg-gray-100{% endif %}">
              <td>{{ l.po }}</td>
              <td>{{ l.destino.nome }}</td>
              <td>{{ l.quantidade }}</td>
              <td>
                <span class="inline-flex items-center px-3 py-1 rounded-lg border text-[clamp(0.95rem,1.2vw,1.3rem)] font-semibold
                  {% if l.status == 'liberado' %}
                    text-green-400 border-green-400
                  {% elif l.status == 'aguardando' %}
                    text-yellow-400 border-yellow-400
                  {% else %}
                    text-gray-400 border-gray-400
                  {% endif %}
                ">
                  <span class="w-3 h-3 mr-2 rounded-full {% if l.status == 'liberado' %}bg-green-400{% elif l.status == 'aguardando' %}bg-yellow-400{% else %}bg-gray-400{% endif %}"></span>
                  {{ l.status|title }}
                </span>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="5" class="text-center py-6 {% if tema == 'escuro' %}text-gray-400{% else %}text-gray-500{% endif %}">Nenhum registro</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
    {% endfor %}
  </main>

  <!-- RESUMO -->
  <section class="mt-16 {% if tema == 'escuro' %}bg-gray-800{% else %}bg-white{% endif %} rounded-xl shadow-md p-6">
    <h2 class="font-semibold mb-5">Resumo Geral</h2>
    <table class="w-full text-[clamp(1rem,1.5vw,1.5rem)]">
      <thead>
        <tr class="{% if tema == 'escuro' %}bg-gray-700 text-gray-300{% else %}bg-gray-200 text-gray-600{% endif %} font-semibold text-left uppercase">
          <th class="py-3">Destino</th><th>Liberado</th><th>Aguardando</th><th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for destino in data %}
        <tr class="border-b {% if tema == 'escuro' %}border-gray-600 hover:bg-gray-700{% else %}hover:bg-gray-50{% endif %}">
          <td>{{ destino.destino_nome }}</td>
          <td>{{ destino.liberado }}</td>
          <td>{{ destino.aguardando }}</td>
          <td>{{ destino.total }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr class="font-bold border-t {% if tema == 'escuro' %}text-gray-100 border-gray-600{% else %}text-gray-800 border-gray-300{% endif %}">
          <td>Total Geral</td>
          <td class="text-green-600">{{ total_liberado }}</td>
          <td class="text-yellow-600">{{ total_aguardando }}</td>
          <td class="text-[clamp(1.2rem,2vw,2rem)] {% if tema == 'escuro' %}text-white{% else %}text-gray-800{% endif %}">{{ total_geral }}</td>
        </tr>
      </tfoot>
    </table>
  </section>

  <!-- SCRIPT PARA ATUALIZAÇÃO AUTOMÁTICA -->
  <script>
    async function atualizarDashboard() {
      try {
        const response = await fetch(window.location.href, { headers: { 'X-Requested-With': 'XMLHttpRequest' } });
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        const novoMain = doc.querySelector('main');
        const novoResumo = doc.querySelector('section');
        const novoBody = doc.querySelector('body');

        if (novoMain && novoResumo && novoBody) {
          document.querySelector('main').innerHTML = novoMain.innerHTML;
          document.querySelector('section').innerHTML = novoResumo.innerHTML;
          document.body.className = novoBody.className;
        }
      } catch (e) {
        console.error('Erro ao atualizar dashboard:', e);
      }
    }

    setInterval(atualizarDashboard, 1000);
  </script>
</body>
</html>
